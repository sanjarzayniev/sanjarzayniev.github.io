<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Articles | Sanjar Zayniev</title>
    <link rel="icon" href="./pics/favicon.png" type="image/x-icon" />
    <link rel="stylesheet" href="styles.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Space+Grotesk:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
      integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
  </head>

  <body>
    <!-- Navigation -->
    <nav class="nav-container">
      <div class="nav-wrapper">
        <a href="index.html" class="logo">
          <span class="logo-text">SZ</span>
        </a>
        <div class="nav-menu">
          <a href="about.html" class="nav-link">About</a>
          <a href="articles.html" class="nav-link active">Articles</a>
          <a href="old.html" class="nav-link">Old</a>
        </div>
        <button class="mobile-menu-toggle" aria-label="Toggle menu">
          <span></span>
          <span></span>
          <span></span>
        </button>
      </div>
    </nav>

    <!-- Main Content -->
    <main class="page-container">
      <h1 class="page-title">Articles</h1>
      <div class="page-content">
        <div id="articles-list" style="display: flex; flex-direction: column; gap: 1.5rem;">
          <div class="loading" style="text-align: center; padding: 2rem; color: rgba(255, 255, 255, 0.6);">
            <p>Loading articles...</p>
          </div>
        </div>
      </div>
    </main>

    <!-- Footer -->
    <footer class="footer">
      <div class="footer-content">
        <p>
          &copy; 2025. Made with
          <i class="fa-solid fa-heart"></i> by Sanjar
        </p>
      </div>
    </footer>

    <script>
      // Mobile menu toggle
      const mobileMenuToggle = document.querySelector(".mobile-menu-toggle");
      const navMenu = document.querySelector(".nav-menu");

      mobileMenuToggle.addEventListener("click", () => {
        navMenu.classList.toggle("active");
        mobileMenuToggle.classList.toggle("active");
      });

      document.querySelectorAll(".nav-link").forEach((link) => {
        link.addEventListener("click", () => {
          navMenu.classList.remove("active");
          mobileMenuToggle.classList.remove("active");
        });
      });

      // Parse frontmatter
      function parseFrontmatter(content) {
        const frontmatterRegex = /^---\s*\n([\s\S]*?)\n---\s*\n([\s\S]*)$/;
        const match = content.match(frontmatterRegex);
        
        if (match) {
          const frontmatterText = match[1];
          const frontmatter = {};
          
          frontmatterText.split('\n').forEach(line => {
            const colonIndex = line.indexOf(':');
            if (colonIndex > -1) {
              const key = line.substring(0, colonIndex).trim();
              let value = line.substring(colonIndex + 1).trim();
              // Remove quotes if present
              if ((value.startsWith('"') && value.endsWith('"')) || 
                  (value.startsWith("'") && value.endsWith("'"))) {
                value = value.slice(1, -1);
              }
              frontmatter[key] = value;
            }
          });
          
          return frontmatter;
        }
        
        return {};
      }

      // Load articles from articles.json
      async function loadArticles() {
        const articlesList = document.getElementById('articles-list');
        articlesList.innerHTML = '';

        let articles = [];

        try {
          // First, try to load from articles.json
          const indexResponse = await fetch('./articles/articles.json');
          if (indexResponse.ok) {
            const index = await indexResponse.json();
            articles = index.articles || [];
          } else {
            throw new Error('articles.json not found');
          }
        } catch (error) {
          console.warn('Could not load articles.json, using fallback:', error);
          // Fallback: try to load example article
          articles = [{ file: 'example-article.md' }];
        }

        // Load full frontmatter from markdown files if not in JSON
        for (let i = 0; i < articles.length; i++) {
          if (!articles[i].title || !articles[i].excerpt) {
            try {
              const response = await fetch(`./articles/${articles[i].file}`);
              if (response.ok) {
                const markdown = await response.text();
                const frontmatter = parseFrontmatter(markdown);
                articles[i] = { ...articles[i], ...frontmatter };
              }
            } catch (error) {
              console.warn(`Could not load ${articles[i].file}:`, error);
            }
          }
        }

        // Sort articles by date (newest first)
        articles.sort((a, b) => {
          if (!a.date) return 1;
          if (!b.date) return -1;
          return new Date(b.date) - new Date(a.date);
        });

        if (articles.length === 0) {
          articlesList.innerHTML = `
            <div style="text-align: center; padding: 3rem; color: rgba(255, 255, 255, 0.6);">
              <p>No articles found. Add markdown files to the articles folder to get started.</p>
            </div>
          `;
          return;
        }

        // Render articles
        articles.forEach(article => {
          const articleCard = document.createElement('article');
          articleCard.className = 'article-card';
          
          let dateDisplay = '';
          if (article.date) {
            const date = new Date(article.date);
            dateDisplay = date.toLocaleDateString('en-US', { 
              year: 'numeric', 
              month: 'long', 
              day: 'numeric' 
            });
          }

          articleCard.innerHTML = `
            <h2 style="font-size: 1.5rem; margin-bottom: 0.5rem; color: #ffffff;">
              <a href="article.html?article=${encodeURIComponent(article.file)}" style="color: inherit; text-decoration: none; transition: color 0.3s ease;">
                ${article.title || 'Untitled Article'}
              </a>
            </h2>
            ${article.excerpt ? `<p style="color: rgba(255, 255, 255, 0.7); margin-bottom: 0.5rem;">${article.excerpt}</p>` : ''}
            ${dateDisplay ? `<p style="color: rgba(255, 255, 255, 0.5); font-size: 0.9rem; margin: 0;">
              <i class="fa-solid fa-calendar"></i> ${dateDisplay}
            </p>` : ''}
          `;

          // Add hover effect
          const link = articleCard.querySelector('a');
          link.addEventListener('mouseenter', () => {
            link.style.color = 'var(--primary-color)';
          });
          link.addEventListener('mouseleave', () => {
            link.style.color = '#ffffff';
          });

          articlesList.appendChild(articleCard);
        });
      }

      // Load articles on page load
      loadArticles();
    </script>
  </body>
</html>
